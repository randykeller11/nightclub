{"ast":null,"code":"import _defineProperty from \"/Users/dub_ceo/Desktop/spacesvr-starter/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { createElement as _createElement } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _objectWithoutProperties from \"/Users/dub_ceo/Desktop/spacesvr-starter/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _jsxFileName = \"/Users/dub_ceo/Desktop/spacesvr-starter/src/ideas/Builder12/layers/communication/visual/VisualDialogue/index.tsx\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useFrame } from \"@react-three/fiber\";\nimport Bubbles from \"./components/Bubbles\";\nimport { createContext, useMemo, useRef, useState } from \"react\";\nimport { DoubleSide, Vector3 } from \"three\";\nimport { RoundedBox } from \"@react-three/drei\";\nimport { VisualInteraction } from \"../VisualInteraction\";\nimport { useSpring, animated } from \"react-spring/three\";\nimport { useLimiter } from \"spacesvr\";\nimport FacePlayer from \"../modifiers/FacePlayer\";\nimport { Idea } from \"../../../basis\";\nexport var DialogueContext = /*#__PURE__*/createContext({});\nexport function VisualDialogue(props) {\n  _s();\n\n  var _this = this;\n\n  var _props$numStops = props.numStops,\n      numStops = _props$numStops === void 0 ? 5 : _props$numStops,\n      _props$enabled = props.enabled,\n      enabled = _props$enabled === void 0 ? false : _props$enabled,\n      dialogue = props.dialogue,\n      children = props.children,\n      _props$builderHeight = props.builderHeight,\n      builderHeight = _props$builderHeight === void 0 ? 0.95 : _props$builderHeight,\n      rest = _objectWithoutProperties(props, [\"numStops\", \"enabled\", \"dialogue\", \"children\", \"builderHeight\"]);\n\n  var WIDTH = 1;\n  var HEIGHT = 0.35;\n  var DEPTH = 0.125;\n  var RADIUS = Math.min(WIDTH, HEIGHT, DEPTH) * 0.5; // @ts-ignore\n\n  var SIDE = props.position && props.position[0] < 0 ? \"left\" : \"right\";\n\n  var _useState = useState(\"init\"),\n      key = _useState[0],\n      setKey = _useState[1];\n\n  var mat = useRef();\n  var curIdea = useMemo(function () {\n    return new Idea();\n  }, []);\n\n  var _useSpring = useSpring({\n    scale: enabled ? 1 : 0\n  }),\n      scale = _useSpring.scale; // anchor for bubbles to track to dialogue\n\n\n  var limiter = useLimiter(50);\n  var group = useRef();\n  var anchor = useRef();\n  var anchorPos = useMemo(function () {\n    return new Vector3();\n  }, []);\n  useFrame(function (_ref) {\n    var clock = _ref.clock;\n    if (!mat.current || !anchor.current || !group.current || !limiter.isReady(clock)) return;\n    mat.current.color.set(curIdea.getHex());\n    anchorPos.set(0, 0, 0);\n    anchorPos.applyMatrix4(anchor.current.matrix);\n    var child = anchor.current;\n\n    while (child.parent && child !== group.current) {\n      child = child.parent;\n      anchorPos.applyMatrix4(child.matrix);\n    }\n\n    anchorPos.y -= builderHeight;\n  });\n  return /*#__PURE__*/_jsxDEV(\"group\", {\n    name: \"dialogue\",\n    children: /*#__PURE__*/_jsxDEV(DialogueContext.Provider, {\n      value: {\n        key: key,\n        setKey: setKey\n      },\n      children: [/*#__PURE__*/_jsxDEV(Bubbles, {\n        \"position-y\": builderHeight,\n        numStops: numStops,\n        enabled: enabled,\n        idea: curIdea,\n        anchorPos: anchorPos\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"group\", _objectSpread(_objectSpread({\n        name: \"main-dialogue\"\n      }, rest), {}, {\n        ref: group,\n        children: /*#__PURE__*/_jsxDEV(\"group\", {\n          \"position-x\": (SIDE === \"left\" ? -1 : 1) * WIDTH / 2,\n          children: /*#__PURE__*/_jsxDEV(FacePlayer, {\n            children: /*#__PURE__*/_jsxDEV(animated.group, {\n              scale: scale,\n              children: [/*#__PURE__*/_jsxDEV(\"group\", {\n                name: \"anchor\",\n                ref: anchor,\n                \"position-x\": (SIDE === \"left\" ? 1 : -1) * WIDTH / 2\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 97,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(RoundedBox, {\n                name: \"base\",\n                args: [WIDTH, HEIGHT, DEPTH],\n                radius: RADIUS,\n                smoothness: 4,\n                children: /*#__PURE__*/_jsxDEV(\"meshStandardMaterial\", {\n                  ref: mat,\n                  side: DoubleSide\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 108,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 102,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"group\", {\n                name: \"interactions\",\n                \"position-z\": DEPTH / 2 + 0.003,\n                children: dialogue.map(function (interaction) {\n                  return /*#__PURE__*/_createElement(VisualInteraction, _objectSpread(_objectSpread({}, interaction), {}, {\n                    enabled: interaction.key === key,\n                    key: interaction.key,\n                    __self: _this,\n                    __source: {\n                      fileName: _jsxFileName,\n                      lineNumber: 112,\n                      columnNumber: 21\n                    }\n                  }));\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 110,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 96,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 11\n        }, this)\n      }), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 5\n  }, this);\n}\n\n_s(VisualDialogue, \"g0L1QGpCUSor+T4TJtr0awuTafY=\", false, function () {\n  return [useSpring, useLimiter, useFrame];\n});\n\n_c = VisualDialogue;\n\nvar _c;\n\n$RefreshReg$(_c, \"VisualDialogue\");","map":{"version":3,"sources":["/Users/dub_ceo/Desktop/spacesvr-starter/src/ideas/Builder12/layers/communication/visual/VisualDialogue/index.tsx"],"names":["useFrame","Bubbles","createContext","useMemo","useRef","useState","DoubleSide","Vector3","RoundedBox","VisualInteraction","useSpring","animated","useLimiter","FacePlayer","Idea","DialogueContext","VisualDialogue","props","numStops","enabled","dialogue","children","builderHeight","rest","WIDTH","HEIGHT","DEPTH","RADIUS","Math","min","SIDE","position","key","setKey","mat","curIdea","scale","limiter","group","anchor","anchorPos","clock","current","isReady","color","set","getHex","applyMatrix4","matrix","child","parent","y","map","interaction"],"mappings":"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","sourcesContent":["import { GroupProps, useFrame } from \"@react-three/fiber\";\nimport Bubbles from \"./components/Bubbles\";\nimport { createContext, useMemo, useRef, useState } from \"react\";\nimport { Dialogue } from \"../../index\";\nimport {\n  DoubleSide,\n  Group,\n  MeshStandardMaterial,\n  Object3D,\n  Vector3,\n} from \"three\";\nimport { RoundedBox } from \"@react-three/drei\";\nimport { VisualInteraction } from \"../VisualInteraction\";\nimport { useSpring, animated } from \"react-spring/three\";\nimport { useLimiter } from \"spacesvr\";\nimport FacePlayer from \"../modifiers/FacePlayer\";\nimport { Idea } from \"../../../basis\";\n\ntype DialogueState = {\n  key: string;\n  setKey: (s: string) => void;\n};\n\nexport const DialogueContext = createContext<DialogueState>(\n  {} as DialogueState\n);\n\ntype VisualDialogueProps = {\n  numStops?: number;\n  enabled?: boolean;\n  builderHeight?: number;\n  dialogue: Dialogue;\n};\n\nexport function VisualDialogue(props: VisualDialogueProps & GroupProps) {\n  const {\n    numStops = 5,\n    enabled = false,\n    dialogue,\n    children,\n    builderHeight = 0.95,\n    ...rest\n  } = props;\n\n  const WIDTH = 1;\n  const HEIGHT = 0.35;\n  const DEPTH = 0.125;\n  const RADIUS = Math.min(WIDTH, HEIGHT, DEPTH) * 0.5;\n  // @ts-ignore\n  const SIDE = props.position && props.position[0] < 0 ? \"left\" : \"right\";\n\n  const [key, setKey] = useState(\"init\");\n  const mat = useRef<MeshStandardMaterial>();\n  const curIdea = useMemo(() => new Idea(), []);\n  const { scale } = useSpring({ scale: enabled ? 1 : 0 });\n\n  // anchor for bubbles to track to dialogue\n  const limiter = useLimiter(50);\n  const group = useRef<Group>();\n  const anchor = useRef<Group>();\n  const anchorPos = useMemo(() => new Vector3(), []);\n\n  useFrame(({ clock }) => {\n    if (\n      !mat.current ||\n      !anchor.current ||\n      !group.current ||\n      !limiter.isReady(clock)\n    )\n      return;\n    mat.current.color.set(curIdea.getHex());\n\n    anchorPos.set(0, 0, 0);\n    anchorPos.applyMatrix4(anchor.current.matrix);\n    let child: Object3D = anchor.current;\n    while (child.parent && child !== group.current) {\n      child = child.parent;\n      anchorPos.applyMatrix4(child.matrix);\n    }\n    anchorPos.y -= builderHeight;\n  });\n\n  return (\n    <group name=\"dialogue\">\n      <DialogueContext.Provider value={{ key, setKey }}>\n        <Bubbles\n          position-y={builderHeight}\n          numStops={numStops}\n          enabled={enabled}\n          idea={curIdea}\n          anchorPos={anchorPos}\n        />\n        <group name=\"main-dialogue\" {...rest} ref={group}>\n          <group position-x={((SIDE === \"left\" ? -1 : 1) * WIDTH) / 2}>\n            <FacePlayer>\n              <animated.group scale={scale}>\n                <group\n                  name=\"anchor\"\n                  ref={anchor}\n                  position-x={((SIDE === \"left\" ? 1 : -1) * WIDTH) / 2}\n                />\n                <RoundedBox\n                  name=\"base\"\n                  args={[WIDTH, HEIGHT, DEPTH]}\n                  radius={RADIUS}\n                  smoothness={4}\n                >\n                  <meshStandardMaterial ref={mat} side={DoubleSide} />\n                </RoundedBox>\n                <group name=\"interactions\" position-z={DEPTH / 2 + 0.003}>\n                  {dialogue.map((interaction) => (\n                    <VisualInteraction\n                      {...interaction}\n                      enabled={interaction.key === key}\n                      key={interaction.key}\n                    />\n                  ))}\n                </group>\n              </animated.group>\n            </FacePlayer>\n          </group>\n        </group>\n      </DialogueContext.Provider>\n    </group>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}