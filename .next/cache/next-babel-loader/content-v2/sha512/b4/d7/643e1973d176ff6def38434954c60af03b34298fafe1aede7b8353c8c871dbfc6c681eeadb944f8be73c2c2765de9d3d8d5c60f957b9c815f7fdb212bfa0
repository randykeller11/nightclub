{"ast":null,"code":"import { createElement as _createElement } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/dub_ceo/Desktop/spacesvr-starter/src/ideas/Builder12/layers/communication/visual/VisualDialogue/index.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { useFrame } from \"@react-three/fiber\";\nimport Bubbles from \"./components/Bubbles\";\nimport { createContext, useMemo, useRef, useState } from \"react\";\nimport { DoubleSide, Vector3 } from \"three\";\nimport { RoundedBox } from \"@react-three/drei\";\nimport { VisualInteraction } from \"../VisualInteraction\";\nimport { useSpring, animated } from \"react-spring/three\";\nimport { useLimiter } from \"spacesvr\";\nimport FacePlayer from \"../modifiers/FacePlayer\";\nimport { Idea } from \"../../../basis\";\nexport const DialogueContext = /*#__PURE__*/createContext({});\nexport function VisualDialogue(props) {\n  const {\n    numStops = 5,\n    enabled = false,\n    dialogue,\n    children,\n    builderHeight = 0.95\n  } = props,\n        rest = _objectWithoutProperties(props, [\"numStops\", \"enabled\", \"dialogue\", \"children\", \"builderHeight\"]);\n\n  const WIDTH = 1;\n  const HEIGHT = 0.35;\n  const DEPTH = 0.125;\n  const RADIUS = Math.min(WIDTH, HEIGHT, DEPTH) * 0.5; // @ts-ignore\n\n  const SIDE = props.position && props.position[0] < 0 ? \"left\" : \"right\";\n  const {\n    0: key,\n    1: setKey\n  } = useState(\"init\");\n  const mat = useRef();\n  const curIdea = useMemo(() => new Idea(), []);\n  const {\n    scale\n  } = useSpring({\n    scale: enabled ? 1 : 0\n  }); // anchor for bubbles to track to dialogue\n\n  const limiter = useLimiter(50);\n  const group = useRef();\n  const anchor = useRef();\n  const anchorPos = useMemo(() => new Vector3(), []);\n  useFrame(({\n    clock\n  }) => {\n    if (!mat.current || !anchor.current || !group.current || !limiter.isReady(clock)) return;\n    mat.current.color.set(curIdea.getHex());\n    anchorPos.set(0, 0, 0);\n    anchorPos.applyMatrix4(anchor.current.matrix);\n    let child = anchor.current;\n\n    while (child.parent && child !== group.current) {\n      child = child.parent;\n      anchorPos.applyMatrix4(child.matrix);\n    }\n\n    anchorPos.y -= builderHeight;\n  });\n  return /*#__PURE__*/_jsxDEV(\"group\", {\n    name: \"dialogue\",\n    children: /*#__PURE__*/_jsxDEV(DialogueContext.Provider, {\n      value: {\n        key,\n        setKey\n      },\n      children: [/*#__PURE__*/_jsxDEV(Bubbles, {\n        \"position-y\": builderHeight,\n        numStops: numStops,\n        enabled: enabled,\n        idea: curIdea,\n        anchorPos: anchorPos\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"group\", _objectSpread(_objectSpread({\n        name: \"main-dialogue\"\n      }, rest), {}, {\n        ref: group,\n        children: /*#__PURE__*/_jsxDEV(\"group\", {\n          \"position-x\": (SIDE === \"left\" ? -1 : 1) * WIDTH / 2,\n          children: /*#__PURE__*/_jsxDEV(FacePlayer, {\n            children: /*#__PURE__*/_jsxDEV(animated.group, {\n              scale: scale,\n              children: [/*#__PURE__*/_jsxDEV(\"group\", {\n                name: \"anchor\",\n                ref: anchor,\n                \"position-x\": (SIDE === \"left\" ? 1 : -1) * WIDTH / 2\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 97,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(RoundedBox, {\n                name: \"base\",\n                args: [WIDTH, HEIGHT, DEPTH],\n                radius: RADIUS,\n                smoothness: 4,\n                children: /*#__PURE__*/_jsxDEV(\"meshStandardMaterial\", {\n                  ref: mat,\n                  side: DoubleSide\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 108,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 102,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"group\", {\n                name: \"interactions\",\n                \"position-z\": DEPTH / 2 + 0.003,\n                children: dialogue.map(interaction => /*#__PURE__*/_createElement(VisualInteraction, _objectSpread(_objectSpread({}, interaction), {}, {\n                  enabled: interaction.key === key,\n                  key: interaction.key,\n                  __self: this,\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 112,\n                    columnNumber: 21\n                  }\n                })))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 110,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 96,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 11\n        }, this)\n      }), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/dub_ceo/Desktop/spacesvr-starter/src/ideas/Builder12/layers/communication/visual/VisualDialogue/index.tsx"],"names":["useFrame","Bubbles","createContext","useMemo","useRef","useState","DoubleSide","Vector3","RoundedBox","VisualInteraction","useSpring","animated","useLimiter","FacePlayer","Idea","DialogueContext","VisualDialogue","props","numStops","enabled","dialogue","children","builderHeight","rest","WIDTH","HEIGHT","DEPTH","RADIUS","Math","min","SIDE","position","key","setKey","mat","curIdea","scale","limiter","group","anchor","anchorPos","clock","current","isReady","color","set","getHex","applyMatrix4","matrix","child","parent","y","map","interaction"],"mappings":"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","sourcesContent":["import { GroupProps, useFrame } from \"@react-three/fiber\";\nimport Bubbles from \"./components/Bubbles\";\nimport { createContext, useMemo, useRef, useState } from \"react\";\nimport { Dialogue } from \"../../index\";\nimport {\n  DoubleSide,\n  Group,\n  MeshStandardMaterial,\n  Object3D,\n  Vector3,\n} from \"three\";\nimport { RoundedBox } from \"@react-three/drei\";\nimport { VisualInteraction } from \"../VisualInteraction\";\nimport { useSpring, animated } from \"react-spring/three\";\nimport { useLimiter } from \"spacesvr\";\nimport FacePlayer from \"../modifiers/FacePlayer\";\nimport { Idea } from \"../../../basis\";\n\ntype DialogueState = {\n  key: string;\n  setKey: (s: string) => void;\n};\n\nexport const DialogueContext = createContext<DialogueState>(\n  {} as DialogueState\n);\n\ntype VisualDialogueProps = {\n  numStops?: number;\n  enabled?: boolean;\n  builderHeight?: number;\n  dialogue: Dialogue;\n};\n\nexport function VisualDialogue(props: VisualDialogueProps & GroupProps) {\n  const {\n    numStops = 5,\n    enabled = false,\n    dialogue,\n    children,\n    builderHeight = 0.95,\n    ...rest\n  } = props;\n\n  const WIDTH = 1;\n  const HEIGHT = 0.35;\n  const DEPTH = 0.125;\n  const RADIUS = Math.min(WIDTH, HEIGHT, DEPTH) * 0.5;\n  // @ts-ignore\n  const SIDE = props.position && props.position[0] < 0 ? \"left\" : \"right\";\n\n  const [key, setKey] = useState(\"init\");\n  const mat = useRef<MeshStandardMaterial>();\n  const curIdea = useMemo(() => new Idea(), []);\n  const { scale } = useSpring({ scale: enabled ? 1 : 0 });\n\n  // anchor for bubbles to track to dialogue\n  const limiter = useLimiter(50);\n  const group = useRef<Group>();\n  const anchor = useRef<Group>();\n  const anchorPos = useMemo(() => new Vector3(), []);\n\n  useFrame(({ clock }) => {\n    if (\n      !mat.current ||\n      !anchor.current ||\n      !group.current ||\n      !limiter.isReady(clock)\n    )\n      return;\n    mat.current.color.set(curIdea.getHex());\n\n    anchorPos.set(0, 0, 0);\n    anchorPos.applyMatrix4(anchor.current.matrix);\n    let child: Object3D = anchor.current;\n    while (child.parent && child !== group.current) {\n      child = child.parent;\n      anchorPos.applyMatrix4(child.matrix);\n    }\n    anchorPos.y -= builderHeight;\n  });\n\n  return (\n    <group name=\"dialogue\">\n      <DialogueContext.Provider value={{ key, setKey }}>\n        <Bubbles\n          position-y={builderHeight}\n          numStops={numStops}\n          enabled={enabled}\n          idea={curIdea}\n          anchorPos={anchorPos}\n        />\n        <group name=\"main-dialogue\" {...rest} ref={group}>\n          <group position-x={((SIDE === \"left\" ? -1 : 1) * WIDTH) / 2}>\n            <FacePlayer>\n              <animated.group scale={scale}>\n                <group\n                  name=\"anchor\"\n                  ref={anchor}\n                  position-x={((SIDE === \"left\" ? 1 : -1) * WIDTH) / 2}\n                />\n                <RoundedBox\n                  name=\"base\"\n                  args={[WIDTH, HEIGHT, DEPTH]}\n                  radius={RADIUS}\n                  smoothness={4}\n                >\n                  <meshStandardMaterial ref={mat} side={DoubleSide} />\n                </RoundedBox>\n                <group name=\"interactions\" position-z={DEPTH / 2 + 0.003}>\n                  {dialogue.map((interaction) => (\n                    <VisualInteraction\n                      {...interaction}\n                      enabled={interaction.key === key}\n                      key={interaction.key}\n                    />\n                  ))}\n                </group>\n              </animated.group>\n            </FacePlayer>\n          </group>\n        </group>\n      </DialogueContext.Provider>\n    </group>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}